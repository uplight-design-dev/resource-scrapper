<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    .resource-widget {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .search-container {
      margin-bottom: 30px;
    }

    .search-input {
      width: 100%;
      padding: 12px 16px;
      font-size: 16px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      outline: none;
      transition: border-color 0.3s;
    }

    .search-input:focus {
      border-color: #0066cc;
    }

    .results-count {
      margin-top: 10px;
      color: #666;
      font-size: 14px;
    }

    .resources-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .resource-card {
      background: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: transform 0.2s, box-shadow 0.2s;
      cursor: pointer;
    }

    .resource-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .resource-thumbnail {
      width: 100%;
      height: 150px;
      object-fit: cover;
      background: #f5f5f5;
    }

    /* Special styling for Press Release logos */
    .resource-thumbnail.press-release {
      object-fit: contain;
      padding: 8px;
      background: white;
    }

    .resource-title {
      padding: 12px;
      font-size: 14px;
      font-weight: 500;
      color: #333;
      line-height: 1.4;
    }

    .resource-type {
      display: block;
      font-size: 11px;
      color: #666;
      text-transform: uppercase;
      margin-bottom: 4px;
      font-weight: 600;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
    }

    .error {
      text-align: center;
      padding: 40px;
      color: #d32f2f;
    }

    .no-results {
      text-align: center;
      padding: 40px;
      color: #666;
    }
  </style>
</head>
<body>
  <div class="resource-widget">
    <div class="search-container">
      <input 
        type="text" 
        class="search-input" 
        id="searchInput" 
        placeholder="Search resources..."
        autocomplete="off"
      />
      <div class="results-count" id="resultsCount"></div>
    </div>

    <div id="resourcesContainer">
      <div class="loading">Loading resources...</div>
    </div>
  </div>

  <script>
    (function() {
      // Load from GitHub raw URL - update this with your repo URL
      const GITHUB_RAW_URL = 'https://raw.githubusercontent.com/uplight-design-dev/resource-scrapper/main/public/resources.json';
      // Fallback to API endpoint
      const API_URL = window.location.origin + '/api/resources';
      // Fallback to local if running locally
      const JSON_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' 
        ? '/resources.json' 
        : GITHUB_RAW_URL;
      
      let allResources = [];
      let filteredResources = [];

      // Fetch resources from JSON file with fallback to API
      async function fetchResources() {
        try {
          // Try GitHub first
          const response = await fetch(JSON_URL);
          const data = await response.json();
          
          // If GitHub has no resources or fails, try API
          if (!data.success || !data.resources || data.resources.length === 0) {
            console.log('GitHub JSON empty or invalid, trying API...');
            const apiResponse = await fetch(API_URL);
            const apiData = await apiResponse.json();
            
            if (apiData.success && apiData.resources && apiData.resources.length > 0) {
              allResources = apiData.resources;
              filteredResources = allResources;
              renderResources();
              updateResultsCount();
              return;
            }
          }
          
          if (data.success && data.resources && data.resources.length > 0) {
            allResources = data.resources;
            filteredResources = allResources;
            renderResources();
            updateResultsCount();
          } else {
            showError('No resources available. Please generate resources.json or check the API.');
          }
        } catch (error) {
          console.error('Error fetching from GitHub, trying API...', error);
          // Fallback to API
          try {
            const apiResponse = await fetch(API_URL);
            const apiData = await apiResponse.json();
            
            if (apiData.success && apiData.resources) {
              allResources = apiData.resources;
              filteredResources = allResources;
              renderResources();
              updateResultsCount();
            } else {
              showError('Error loading resources. Please try again later.');
            }
          } catch (apiError) {
            console.error('Error fetching from API:', apiError);
            showError('Error loading resources. Please try again later.');
          }
        }
      }

      // Render resources
      function renderResources() {
        const container = document.getElementById('resourcesContainer');
        
        if (filteredResources.length === 0) {
          container.innerHTML = '<div class="no-results">No resources found</div>';
          return;
        }

        container.innerHTML = '<div class="resources-grid">' + filteredResources.map(resource => {
          const img = resource.thumbnail || 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="200" height="150"%3E%3Crect fill="%23f5f5f5" width="200" height="150"/%3E%3Ctext x="50%25" y="50%25" text-anchor="middle" dy=".3em" fill="%23999" font-family="sans-serif" font-size="14"%3ENo Image%3C/text%3E%3C/svg%3E';
          const type = resource.type || 'Resource';
          const title = escapeHtml(resource.title);
          const url = resource.url || '#';
          const thumbnailClass = type.toLowerCase() === 'press release' ? 'resource-thumbnail press-release' : 'resource-thumbnail';
          return `<div class="resource-card" onclick="window.open('${url}','_blank')"><img src="${img}" alt="${title}" class="${thumbnailClass}" loading="lazy" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'200\' height=\'150\'%3E%3Crect fill=\'%23f5f5f5\' width=\'200\' height=\'150\'/%3E%3C/svg%3E'"/><div class="resource-title"><span class="resource-type">${escapeHtml(type)}</span>${title}</div></div>`;
        }).join('') + '</div>';
      }

      // Search functionality
      function handleSearch() {
        const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
        
        if (searchTerm === '') {
          filteredResources = allResources;
        } else {
          filteredResources = allResources.filter(resource =>
            resource.title.toLowerCase().includes(searchTerm) ||
            (resource.type && resource.type.toLowerCase().includes(searchTerm))
          );
        }
        
        renderResources();
        updateResultsCount();
      }

      // Update results count
      function updateResultsCount() {
        const countEl = document.getElementById('resultsCount');
        const total = allResources.length;
        const showing = filteredResources.length;
        
        if (showing === total) {
          countEl.textContent = `Showing all ${total} resources`;
        } else {
          countEl.textContent = `Showing ${showing} of ${total} resources`;
        }
      }

      // Show error message
      function showError(message) {
        document.getElementById('resourcesContainer').innerHTML = 
          `<div class="error">${escapeHtml(message)}</div>`;
      }

      // Escape HTML to prevent XSS
      function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }

      // Initialize
      document.getElementById('searchInput').addEventListener('input', handleSearch);
      fetchResources();
    })();
  </script>
</body>
</html>

